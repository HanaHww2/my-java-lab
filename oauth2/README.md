# Springboot-Oauth2

### springboot 2.7.1
- security config에서 인터페이스를 구현하는 방식에서 필터를 생성해 빈으로 등록하도록 하는 등의 변화가 조금 있지만, 세부적으로는 코드가 유지되어서 큰 문제는 없을 것 같다.
- 보안이 필요한 키값을 깃에 업로드하지 않기 위해 설정 파일을 분리하고, profile로 관리 
#### TODO 
- authorization 코드를 받고, 유저 정보를 가져오는 동작 과정을 확인하고, access token을 프론트에 전달하는 로직이 필요하다. 현재 로그인 처리 후 백단 서버의 루트 / 로 리디렉션이 된다.
- 더하여 리프레쉬 토큰을 저장하는 로직이 필요할 것이고, access token의 유효기간을 확인하여 이 기간이 만료되면, 리프레쉬 토큰을 재사용해 서버에서 access 토큰을 얻고 정보를 가져올 수 있을 것이다. 
  - 리프레쉬 토큰은 프론트로 전달하지 않는 것을 원칙으로 한다고 한다. (구글 Oauth 문서에 따르면)
  - 갱신 토큰은 기간으로 제약을 걸지는 않는 거 같고(만료 시간 조건이 응답에 전달되지 않음), 다른 조건들을 만족할 때, 폐기가 되는 것 같다.
    - 사용자가 액세스 권한을 취소한 경우
    - 갱신 토큰의 발급 최대 갯수를 초과한 경우, 오래된 순으로 폐기
- 리디렉션 로직을 파악해야 할 것 같다.
  - 일단 브라우저에서 api 호출을 할 때, 시큐리티에서 로그인이 필요한 경우로 판단하면, 바로 google Oauth2 페이지로 던져버린다.
    - 프론트엔드 서버를 따로 둘 예정이므로, api 엔드포인트가 외부로 노출되지 않도록 일단 막아야 한다. (how?)
      - 서버 ip를 숨긴다든지..., aws를 이용하는 경우라면 인바운드 제약을 걸어줄 수 있고, 스프링에서는 cors 제약으로 프론트 서버에만 접근을 허용하거나 필터를 추가해볼 수 있지 않을까?
- 근데 auth 서버는 그렇다 치고, 클라이언트(내) 서버 입장에서는 내 리소스에 대한 접근 권한을 어떻게 제어할 것인가가 다시 고민이 된다.
  - 리프레시 토큰은 사용자(프엔)가 아닌 내(백엔)가 갖고 있다. 사용자와 내 사이에는 access 토큰값 외엔 동시에 갖는 값이 없으므로... access token을 암호화해서 인증값으로 쓴다? 일까? 혹은 또 다른 jwt 토큰 생성인가...?
  - https://docs.spring.io/spring-security/reference/servlet/oauth2/client/authorization-grants.html 문서를 보고 더 공부해봐야 겠다.
- 세션 대신 토큰과 레디스를 활용하기!
- 카카오, 네이버도 연동 추가하기(확장성 있는 코드, DI 활용, 인터페이스를 활용한 전략 패턴)
- 자체 인증 서버 구축 (시큐리티가 제공하는 Oauth2 서버 활용해보기)